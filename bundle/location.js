"use strict";var app=new Vue({el:"#wrappper",data:{geocoder:null,current_location:null,current_area:null,notyet:!0,select_data:[],search_city:"",search_dist:"",search_txt:"",allAct:[],allStore:[],allGeoData:[],showActBanner:!1,actBannerTitle:"",actBannerDes:"",actBannerPic:""},watch:{search_city:function(e){this.search_dist=this.search_txt=""}},mounted:function(){var e=this;console.log("mounted"),this.$nextTick(function(){e.init(),e.initialize(),e.selectInit(),e.bannerInit(),window.addEventListener("keydown",function(t){13===t.keyCode&&e.serch()})})},methods:{init:function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(this.successFunction,this.errorFunction)},selectInit:function(){var e=this;$.ajax({url:domain+"/golden/api/dist_list.ashx",type:"GET",dataType:"json",success:function(t){e.select_data=t},error:function(){console.alert("ERROR!!!")}})},bannerInit:function(){var e=this,t=(new Date).getTime();$.ajax({url:domain+"/golden/api/get_store_banner.ashx",type:"GET",dataType:"json",success:function(n){e.actBannerTitle=n.title,e.actBannerDes=n.con,e.actBannerPic=domain+"/golden/pic/store/banner.jpg?v="+t},error:function(){console.alert("ERROR!!!")}})},successFunction:function(e){var t=e.coords.latitude,n=e.coords.longitude;this.codeLatLng(t,n)},errorFunction:function(){console.error("Geocoder failed"),this.callApi("台北市")},initialize:function(){geocoder=new google.maps.Geocoder},codeLatLng:function(e,t){console.log("取得位置",e,t);var n=new google.maps.LatLng(e,t),a=this;geocoder.geocode({latLng:n},function(e,t){if(t==google.maps.GeocoderStatus.OK)if(e[1]){for(var n=0;n<e[0].address_components.length;n++)for(var o=0;o<e[0].address_components[n].types.length;o++)if("administrative_area_level_1"==e[0].address_components[n].types[o]){city=e[0].address_components[n];break}a.callApi(city.short_name)}else console.alert("No results found"),a.callApi("台北市");else console.error("Geocoder failed due to: "+t),a.callApi("台北市")})},callApi:function(e){var t=this;$.ajax({url:domain+"/golden/api/location.ashx",type:"GET",dataType:"json",success:function(n){t.allGeoData=n,t.current_location=e,t.search_city=e,t.getArea()},error:function(){console.alert("ERROR!!!")}})},timeModify:function(e){return e>12?e-12+" pm":e+" am"},getArea:function(){var e=this;this.allGeoData.filter(function(t,n){t.City===e.current_location&&null===e.current_area&&(e.current_area=t.Area,console.log(e.current_area),e.getAreaAct(),e.getStore())})},getStore:function(){var e=this;this.allStore=[],$(".store_wrapper li").removeClass("show"),this.allGeoData.filter(function(t,n,a){if(t.Area===e.current_area){var o=t;e.allStore.push(o)}})},getAreaAct:function(){var e=this;this.allGeoData.filter(function(t,n,a){if(t.Activities.length>0&&t.Area===e.current_area){var o=t.Activities;Object.keys(o).map(function(t){var n=o[t];e.allAct.push(n)})}}),this.allAct.sort(function(e,t){return parseFloat(t.People)-parseFloat(e.People)})},backgroundFunc:function(e){return"url("+e+")"},fb_click:function(e){window.open(e)},seeAct:function(e){$(this.$refs.i[e]).toggleClass("show"),$(this.$refs.i[e]).find(".detail").slideToggle("show")},serch:function(){var e=this;if(""===this.search_txt.trim()&&""===this.search_city&&""===this.search_dist)this.getStore();else{this.allStore=[];var t=[],n=[],a=[];this.allGeoData.filter(function(o,i){if(o.Address.indexOf(e.search_txt)>-1){r=o;t.push(r)}else if(o.StoreName.indexOf(e.search_txt)>-1){var r=o;t.push(r)}i===e.allGeoData.length-1&&t.filter(function(o,i){if(o.City.indexOf(e.search_city)>-1){var r=o;n.push(r)}i===t.length-1&&n.filter(function(t,o){if(t.Dist.indexOf(e.search_dist)>-1){var i=t;a.push(i)}o===n.length-1&&(console.log(a),e.allStore=a)})})})}},areaHandler:function(e){this.current_area=e,this.search_city=this.search_dist=this.search_txt="",this.getStore()}}});