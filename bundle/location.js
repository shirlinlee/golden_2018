"use strict";var app=new Vue({el:"#wrapper",data:{geocoder:null,current_location:null,current_area:null,notyet:!0,select_data:[],search_city:"",search_dist:"",search_txt:"",allAct:[],allStore:[],allGeoData:[],showActBanner:!1,actBannerTitle:"",actBannerDes:"",actBannerPic:"",from_index:!1,actNumber:2},computed:{slideWidth:function(){return 200*this.actNumber+"px"}},watch:{search_city:function(t){this.notyet||(this.search_dist=this.search_txt="")}},beforeMount:function(){0===this.getParameterByName("city").length&&0===this.getParameterByName("dist").length&&0===this.getParameterByName("txt").length||(this.search_city=this.getParameterByName("city"),this.search_dist=this.getParameterByName("dist"),this.search_txt=this.getParameterByName("txt"),this.callApi(this.search_city),this.from_index=!0,window.history.pushState({},document.title,"/golden/location"))},mounted:function(){var t=this;this.$nextTick(function(){t.from_index||(t.init(),t.initialize()),t.selectInit(),t.bannerInit(),window.addEventListener("keydown",function(e){13===e.keyCode&&t.serch()}),gtag("config","UA-129178589-1",{page_title:"全台夢想據點",page_path:"/location"})})},methods:{init:function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(this.successFunction,this.errorFunction),this.callApi("台北市")},selectInit:function(){var t=this;$.ajax({url:domain+"/golden/api/dist_list.ashx",type:"GET",dataType:"json",success:function(e){t.select_data=e},error:function(){console.alert("ERROR!!!")}})},bannerInit:function(){var t=this,e=(new Date).getTime();$.ajax({url:domain+"/golden/api/get_store_banner.ashx",type:"GET",dataType:"json",success:function(i){t.actBannerTitle=i.title,t.actBannerDes=i.con,t.actBannerPic=domain+"/golden/pic/store/banner.jpg?v="+e},error:function(){console.alert("ERROR!!!")}})},successFunction:function(t){var e=t.coords.latitude,i=t.coords.longitude;this.codeLatLng(e,i)},errorFunction:function(){console.error("Geocoder failed")},initialize:function(){"undefined"!=typeof google&&(geocoder=new google.maps.Geocoder)},codeLatLng:function(t,e){console.log("取得位置",t,e);var i=new google.maps.LatLng(t,e),a=this;geocoder.geocode({latLng:i},function(t,e){if(e==google.maps.GeocoderStatus.OK)if(t[1]){for(var i=0;i<t[0].address_components.length;i++)for(var n=0;n<t[0].address_components[i].types.length;n++)if("administrative_area_level_1"==t[0].address_components[i].types[n]){city=t[0].address_components[i];break}a.callApi(city.short_name)}else console.alert("No results found");else console.error("Geocoder failed due to: "+e)})},callApi:function(t){var e=this;$.ajax({url:domain+"/golden/api/location.ashx",type:"GET",dataType:"json",success:function(i){e.allGeoData=i,e.current_location=t,e.search_city=t,e.getArea()},error:function(){console.alert("ERROR!!!")}})},timeModify:function(t){return t>12?t-12+" pm":t+" am"},getArea:function(){var t=this;this.allGeoData.filter(function(e,i){e.City===t.current_location&&null===t.current_area&&(t.current_area=e.Area,t.getAreaAct(),t.getStore())})},getStore:function(){var t=this;this.allStore=[],$(".store_wrapper li").removeClass("show"),this.allGeoData.filter(function(e,i,a){if(e.Area===t.current_area)if(t.from_index){if(e.City===t.search_city)if(t.search_dist){if(e.Dist===t.search_dist)if(t.search_txt){if(e.Address.indexOf(t.search_txt)>-1){n=e;t.allStore.push(n)}}else{n=e;t.allStore.push(n)}}else{n=e;t.allStore.push(n)}}else{var n=e;t.allStore.push(n)}}),this.notyet=!1},getAreaAct:function(){var t=this;this.allGeoData.filter(function(e,i,a){if(e.Activities.length>0&&e.Area===t.current_area){var n=e.Activities;Object.keys(n).map(function(e){var i=n[e];t.allAct.push(i)})}}),this.allAct.sort(function(t,e){return parseFloat(e.People)-parseFloat(t.People)}),""===domain&&(this.actNumber=this.allAct.length>=3?3:this.allAct.length),console.log(this.actNumber)},backgroundFunc:function(t){return"url("+t+")"},fb_click:function(t,e){gtag("event","click",{event_category:"location_click",event_action:"fb_btn_"+e}),window.open(t)},seeAct:function(t,e){gtag("event","click",{event_category:"location_click",event_action:"see_act_btn_"+e}),$(this.$refs.i[t]).toggleClass("show"),$(this.$refs.i[t]).find(".detail").slideToggle("show")},hot_act:function(t,e){gtag("event","click",{event_category:"location_click",event_action:"go_act"+e}),window.open(t)},serch:function(){var t=this;if(gtag("event","click",{event_category:"location_click",event_action:"go_location_search"}),""===this.search_txt.trim()&&""===this.search_city&&""===this.search_dist)this.getStore();else{this.allStore=[];var e=[],i=[],a=[];this.allGeoData.filter(function(n,o){if(n.Address.indexOf(t.search_txt)>-1){c=n;e.push(c)}else if(n.StoreName.indexOf(t.search_txt)>-1){var c=n;e.push(c)}o===t.allGeoData.length-1&&e.filter(function(n,o){if(n.City.indexOf(t.search_city)>-1){var c=n;i.push(c)}o===e.length-1&&i.filter(function(e,n){if(e.Dist.indexOf(t.search_dist)>-1){var o=e;a.push(o)}n===i.length-1&&(console.log(a),t.allStore=a)})})})}},index_search:function(){gtag("event","click",{event_category:"index_click",event_action:"go_location_page"}),window.location="/golden/location?city="+this.search_city+"&dist="+this.search_dist+"&txt="+this.search_txt},areaHandler:function(t){this.current_area=t,this.search_city=this.search_dist=this.search_txt="",this.getStore()},getParameterByName:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}}});