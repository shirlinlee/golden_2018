"use strict";var app=new Vue({el:"#wrappper",data:{geocoder:null,current_location:"",current_area:null,notyet:!0,select_data:[],search_city:"",search_dist:"",search_txt:"",allAct:[],allStore:[],allGeoData:[],showActBanner:!1},updated:function(){},mounted:function(){var t=this;this.$nextTick(function(){t.init(),t.initialize(),t.selectInit(),window.addEventListener("keydown",function(e){13===e.keyCode&&t.serch()})})},methods:{init:function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(this.successFunction,this.errorFunction)},selectInit:function(){var t=this;$.ajax({url:"https://cathay.webgene.com.tw/golden2018/api/dist_list.ashx",type:"GET",dataType:"json",success:function(e){t.select_data=e},error:function(){console.alert("ERROR!!!")}})},successFunction:function(t){var e=t.coords.latitude,o=t.coords.longitude;this.codeLatLng(e,o)},errorFunction:function(){console.error("Geocoder failed")},initialize:function(){geocoder=new google.maps.Geocoder},codeLatLng:function(t,e){var o=new google.maps.LatLng(t,e),n=this;geocoder.geocode({latLng:o},function(t,e){if(e==google.maps.GeocoderStatus.OK)if(t[1]){for(var o=0;o<t[0].address_components.length;o++)for(var a=0;a<t[0].address_components[o].types.length;a++)if("administrative_area_level_1"==t[0].address_components[o].types[a]){city=t[0].address_components[o];break}$.ajax({url:"https://cathay.webgene.com.tw/golden2018/api/location.ashx",type:"GET",dataType:"json",success:function(t){n.allGeoData=t,n.current_location=city.short_name,n.search_city=city.short_name,console.log(n.search_city),n.getArea()},error:function(){console.alert("ERROR!!!")}})}else console.alert("No results found");else console.error("Geocoder failed due to: "+e)})},timeModify:function(t){return t>12?t-12+" pm":t+" am"},getArea:function(){var t=this;this.allGeoData.filter(function(e,o){e.City===t.current_location&&null===t.current_area&&(t.current_area=e.Area,t.getAreaAct(),t.getStore())})},getStore:function(){var t=this;this.allStore=[],$(".store_wrapper li").removeClass("show"),this.allGeoData.filter(function(e,o,n){if(e.Area===t.current_area){var a=e;t.allStore.push(a)}})},getAreaAct:function(){var t=this;this.allGeoData.filter(function(e,o,n){if(e.Activities.length>0&&e.Area===t.current_area){var a=e.Activities;Object.keys(a).map(function(e){var o=a[e];t.allAct.push(o)})}}),this.allAct.sort(function(t,e){return parseFloat(e.People)-parseFloat(t.People)})},backgroundFunc:function(t){return"url("+t+")"},fb_click:function(t){window.open(t)},seeAct:function(t){$(this.$refs.i[t]).toggleClass("show"),$(this.$refs.i[t]).find(".detail").slideToggle("show")},serch:function(){var t=this;if(""===this.search_txt.trim()&&""===this.search_city&&""===this.search_dist)console.log("1"),this.getStore();else{this.allStore=[];var e=[],o=[],n=[];this.allGeoData.filter(function(a,i){if(a.Address.indexOf(t.search_txt)>-1){r=a;e.push(r)}else if(a.StoreName.indexOf(t.search_txt)>-1){var r=a;e.push(r)}i===t.allGeoData.length-1&&e.filter(function(a,i){if(a.City.indexOf(t.search_city)>-1){var r=a;o.push(r)}i===e.length-1&&o.filter(function(e,a){if(e.Dist.indexOf(t.search_dist)>-1){var i=e;n.push(i)}a===o.length-1&&(console.log(n),t.allStore=n)})})})}},areaHandler:function(t){this.current_area=t,this.search_city=this.search_dist=this.search_txt="",this.getStore()}}});