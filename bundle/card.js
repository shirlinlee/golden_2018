"use strict";!function(){new Vue({el:".wrap",data:{initTitle:!1,isOpen:!1,isRandom:!1,step:$.cookie("id")?2:1,fbID:$.cookie("id")?$.cookie("id"):"",name:$.cookie("name")?$.cookie("name"):"",email:$.cookie("email")?$.cookie("email"):"",dream:"",title:"扛霸子",pic:$.cookie("id")?"https://graph.facebook.com/"+$.cookie("id")+"/picture?type=large":"",pic_for_canvas:"",pic_base64:"",share_url:"",normalList:{cathay:["高登人氣新人王","超級業務王","高登明日之星","業績超新星","頂尖業務高手","高登MVP","高登潛力股","明星業務員","高登業務傳奇","團隊扛壩子"],dream:["街頭撩妹冠軍","急凍冷笑話大王","台灣電競宗師","空氣吉他大師","發呆界王者","最萌鏟屎官","紫爆文生產機","地表最強背包客","吃不胖專家","國民初戀情人","噴飯諧星咖","天才饒舌歌手","時尚終結者","年輕創業偶像","台灣巴飛特","桌遊之神","笑點超低冠軍","網路傳奇紅人","一秒入睡達人","專業老司機"]},random_num:0,canvas:null},computed:{finalName:function(){return 3==this.name.length?this.name.split("")[0]+"&nbsp;&nbsp;"+this.name.split("")[1]+this.name.split("")[2]:4==this.name.length?this.name.split("")[0]+this.name.split("")[1]+"&nbsp;&nbsp;"+this.name.split("")[2]+this.name.split("")[3]:this.name},finalDream:function(){var t=this.dream;return this.isRandom||(t+="無"!=this.title?this.title:""),t},afterWidth:function(){return"word"+this.finalDream.length}},created:function(){window.addEventListener("scroll",this.ctrlScroll),window.addEventListener("orientationchange",this.avoidAnriod)},beforeMount:function(){var t=["img/namecard_bg.jpg"];this.loadImages(t,function(){})},mounted:function(){var t=this;window.onload=function(){1==t.step&&""===t.fbID?setTimeout(function(){document.querySelector(".wrap.card .content").classList.add("step1Show")},500):2==t.step&&setTimeout(function(){document.querySelector(".wrap.card .content").classList.add("step2Show"),t.getuserImg()},500)}},methods:{getuserImg:function(){var t=this;$.ajax({type:"POST",url:domain+"/golden/api/up_fb_pic.ashx",data:{fb_pic:this.pic},complete:function(e){t.pic_for_canvas=e.responseJSON.fb_pic_url,console.log("轉換圖",e.responseJSON.fb_pic_url)}})},ctrlScroll:function(){var t=$(window).scrollTop(),e=$(".wrap.card .content").offset().top/3*2;!this.initTitle&&t>=e&&(this.initTitle=!0,window.removeEventListener("scroll",this.ctrlScroll),document.querySelector(".wrap.card .content").classList.add("step1Show"))},next:function(t){if(2==this.step){if(""==this.name)return void alert("請輸入姓名！");if(""==this.dream)return void alert("請輸入夢想！");var e=this;this.drawCanvas(function(){$.ajax({type:"POST",url:domain+"/golden/api/post_card.ashx",data:{fbid:e.fbID,name:e.name,email:e.email,pic_64:e.pic_base64,job:e.title},complete:function(t){200===t.status?(console.log("合成成功"),e.share_url=t.responseJSON.fb_url):console.log("合成失敗")}})})}this.step=t,this.$nextTick(function(){3==t&&setTimeout(function(){document.querySelector(".wrap.card .content").classList.add("step3Show"),document.querySelector(".title .join").classList.add("show")},250)})},drawCanvas:function(t){void 0===t&&(t=null),this.canvas=document.getElementById("share_canvas");var e=this.canvas.getContext("2d"),n=document.getElementById("user_img");e.drawImage(n,267,35,65,65);var i=document.getElementById("basic_img");e.drawImage(i,0,0,600,315),e.fillStyle="#00a84e",e.font="18px Arial",e.fillText("高登超級新人王",65,70),this.canvas.style.letterSpacing=".5px",e.font="11px Arial",e.fillText("cathaylife@cathay.com",66,90),this.canvas.style.letterSpacing="1px",e.font="20px Arial",e.fillText(this.name,270,165),this.pic_base64=this.canvas.toDataURL("image/png"),t&&t()},random:function(){var t=this.random_num,e=this.normalList.cathay,n=Math.floor(Math.random()*e.length);this.isRandom=!0;do{n=Math.floor(Math.random()*e.length),this.random_num=n,this.dream=e[n]}while(t==n)},loadImages:function(t,e){function n(t){t==a&&e()}var i,a=t.length,o=0;for(i=0;i<a;++i){var s=t[i],c=document.createElement("img");c.src=s,c.addEventListener("load",function(){this.complete&&n(++o)})}},shareFB:function(){"192.168.123.30"!=location.hostname&&"127.0.0.1"!=location.hostname&&FB.ui({method:"share",href:this.share_url,display:"popup",hashtag:"#斜槓人生在走兩張名片要有"},function(t){console.log("fb_share",t)})},chkFB:function(){var t=this;"192.168.123.30"!=location.hostname&&"127.0.0.1"!=location.hostname?FB.login(function(e){"connected"===e.status&&FB.api("/me","GET",{fields:"id,name,email"},function(e){console.log(e),t.fbID=e.id,t.name=e.name,t.email=e.email,t.pic="https://graph.facebook.com/"+e.id+"/picture?type=large",t.step=2,setTimeout(function(){document.querySelector(".wrap.card .content").classList.add("step2Show"),t.getuserImg()},250)})},{scope:"email"}):(this.fbID="1969571996469866",this.name="紀術部",this.email="technic@webgene.com.tw",this.pic="https://graph.facebook.com/1969571996469866/picture?type=large",this.dream="工程師",this.title="扛霸子",this.step=2,setTimeout(function(){document.querySelector(".wrap.card .content").classList.add("step2Show")},250))},avoidAnriod:function(t){(function(){var t=navigator.userAgent||navigator.vendor||window.opera;return!!/android/i.test(t)})()&&(document.querySelector(".trans_bg").classList.add("input_focus"),screen.orientation.onchange=function(){"landscape"==screen.orientation.type.match(/\w+/)[0]&&document.querySelector(".trans_bg").classList.remove("input_focus")})}},destroyed:function(){window.removeEventListener("scroll",this.ctrlScroll),window.removeEventListener("orientationchange",this.avoidAnriod)}})}();